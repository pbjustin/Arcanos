{
  "$schema": "https://railway.app/railway.schema.json",
  "name": "arcanos-backend",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "npm ci --include=dev --no-audit --no-fund && npm run build",
    "cache": {
      "npm": false
    },
    "env": {
      "NODE_ENV": "production",
      "NODE_OPTIONS": "--max_old_space_size=2048"
    }
  },
  "deploy": {
    "startCommand": "npm run dist:repair-aliases && node --loader ./scripts/esm-alias-loader.mjs --max-old-space-size=7168 dist/start-server.js",
    "healthcheckPath": "/health",
    "healthcheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10,
    "env": {
      "NODE_ENV": "production",
      "PORT": "$PORT",
      "RUN_WORKERS": "false"
    }
  },
  "environments": {
    "production": {
      "variables": {
        "NODE_ENV": "production",
        "PORT": "$PORT",
        "DATABASE_URL": "$DATABASE_URL",
        "OPENAI_API_KEY": "$OPENAI_API_KEY",
        "OPENAI_BASE_URL": "$OPENAI_BASE_URL",
        "AI_MODEL": "$AI_MODEL",
        "GPT51_MODEL": "$GPT51_MODEL",
        "GPT5_MODEL": "$GPT5_MODEL",
        "RAILWAY_ENVIRONMENT": "production",
        "RUN_WORKERS": "false",
        "WORKER_API_TIMEOUT_MS": "60000",
        "ARC_LOG_PATH": "/tmp/arc/log",
        "ENABLE_ACTION_PLANS": "false",
        "ENABLE_CLEAR_2": "false"
      }
    },
    "development": {
      "variables": {
        "NODE_ENV": "development",
        "PORT": "8080",
        "RUN_WORKERS": "true"
      }
    }
  }
}
